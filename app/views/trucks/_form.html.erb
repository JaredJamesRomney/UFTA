<%= form_for(truck) do |f| %>
  <% if truck.errors.any? %>
      <% truck.errors.full_messages.each do |error| %>
        <%= alert_generater error %>
      <% end %>
  <% end %>

  <div class="row ">
    <div class="col-md-6">
      <div class="form-group">
        <%= f.label :truck_name %>
        <%= f.text_field :truck_name, class: 'form-control' %>
      </div>

      <div class="form-group imageUpload">
        <%= f.label :main_image, for: "#{imageId = SecureRandom.uuid}", class: "btn btn-large btn-primary" %>
        <%= f.file_field :main_image, id: "#{imageId}", class: "hide", onclick: "reply_click(this.id)" %>
        <img src="" id="<%= (imageId + "1") %>" alt="Preview Image" width="200px"/>
      </div>

      <div class="form-group imageUpload">
        <%= f.label :thumb_image, for: "#{imageId = SecureRandom.uuid}", class: "btn btn-large btn-primary" %>
        <%= f.file_field :thumb_image, id: "#{imageId}", class: "hide", onclick: "reply_click(this.id)" %>
        <img src="" id="<%= (imageId + "1") %>" alt="Preview Image" width="200px"/>
      </div>
    </div>

    <div class="col-md-6">
      <div class="form-group">
        <%= f.label :description %>
        <%= f.text_area :description, class: 'form-control', rows: 13%>
      </div>
    </div>
  </div>

  <hr>

  <h2>Menu:</h2>
  <div class="form-group">
    <%= f.fields_for :menus do |menu_form| %>
      <%= render 'menu_fields', f: menu_form %>
    <% end %>

    <div class="form-group">
      <%= link_to_add_association 'Add Menu Item', f, :menus, class: 'btn btn-outline-success' %>
    </div>
  </div>

  <div class="form-group">
    <%= f.submit 'Save Truck', class: 'btn btn-primary btn-block' %>
  </div>
<% end %>

<script type="text/javascript">
  function reply_click(clicked_id) {
    var imgFile = document.getElementById(clicked_id);
    var prevNum = `${clicked_id}1`;

    $(imgFile).change(function(){      
      readImgUrlAndPreview(this);
      function readImgUrlAndPreview(input){
        if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {                    
            $(`#${prevNum}`).attr('src', e.target.result);
          }
        };
        reader.readAsDataURL(input.files[0]);
      } 
    });
  }
</script>
